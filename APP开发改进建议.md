# APP开发改进建议
## 改进目标

* app配置化,快速构建新版本
* app代码集中管理,所有app使用一份内核

## app产品现状与问题分析

以橙立方产品为例,现在面临的主要问题为:

####1.产品老旧,代码冗杂

  在经历过上一轮的产品迭代形成稳定版本后,很长一段时间没有产品的大规模迭代和版本更新,以至于现在工程还是MRC(苹果开发者大会2011提出推荐使用ARC替换MRC).工程中引用的库大多老旧,甚至有的库已经停止维护

产品总体使用了MVC的架构,但是后来代码越来越乱,架构逻辑慢慢不清晰,代码维护难度大,新功能的添加和修改难度大

####2.产品分支多,分支与分支的区别度太大

目前来说,整体的项目交付是以橙立方app为基准,添加一些客户的logo,图标,名称,关于我们等等表层的显示上的改动,还有一些内核上的改动,如内蒙古项目中的关于epbu复制权限问题,广西社社书架显示多文件.

由于历史原因,各个项目根据自己的分支,做自己的适应性改动,以及根据这些适应性开发后导致的bug和新功能调整等,导致内核代码分散在各个分支中,以至于不知道那个分支是主版本,那个分支版本全,导致牵一发动全身.维护起来困难

####3.代码不规范,git版本控制使用不规范

产品迭代后,解决bug后,开发都是根据目前需求,或者改bug,对现有代码做最小化的改动,对代码把握度不够,修改的不正确,各个模块的耦合性大,以至于后来,开发只能在代码上做加法,而不敢精简代码(做减法),代码越来越多

git版本控制不规范,随意拉分支,各个分支随意merge,导致仓库的代码库对于历史版本无法把控

####4.产品的开发和销售分离

就和行军打仗一样,兵不知将,将不知兵,销售时,销售人员都现有产品把握或许不够,不知道产品(橙立方)能够提供什么服务,也许就当一个阅读器来销售,没有市场竞争力.然而为了销售产品,一股脑的答应客户的需求,也会导致产品的开发流程的混乱和难以管理

产品新版本的开发迭代也存在着很大的问题,在以前,橙立方也是一款很有竞争力的产品,但是慢慢的,人们对产品会有新的要求,使用更流畅,页面更丰富,画面更精美等等. 以目前的产品对接用户就完全满足不了了.
就想一件均码的衣服,所有的人都能穿下去,但是几乎所有的人都穿着都不合身.产品没有特点就没有用户


## 改进具体措施

谈改进之前,我先把目前的工程简单的描述一下: (橙立方)

**外层的应用架子**: 登录\注册\注销登录, 支付,分享和推送通知等

**数据**: 主要有云端数据拉取, 书籍下载, 数据库的增删改查模块,加解密模块

**用户行为数据**: 主要是"+"按钮上行为数据模块

**内核**: DPUB PDF EPUB 等


####措施1: APP骨架和APP内核分离

DPUB,epub等内核可以封装起来,独立管理,通过第三方库管理工具cocoapod(ios)等集成到工程中,这样做的好处是一个模块化,第二个也容易分发给别的客户端用.

每一个内核应该做到能够独立运行,易于集成,也需要提供分布api以供客户端选择内核的显示样式

每一个内核,需求明确独立的负责人主管内核, 客户端在集成内核后,不能修改内核的代码,如有新的需求和bug可以通知该负责人进行bug的修复和新版本的更新,也可以由集成人通过pull request的方式,在经过负责人审核后集成到内核中.

####措施2: 修改旧的代码,按照mvc或者mvp等结构模式重构代码

主要从: 

* 按照MVC等框架分离代码
* 拆分公共函数
* 替换老框架
* 修改为ARC
* 注意使用单例(主要是从数据库方面)
* 使用纯代码或者慎用storyboard
* 从产品角度增加对UI层面的控制(可参考前端的css样式)

####措施3: 具体代码内的布局

一个良好的代码布局有助于代码的维护和二次开发,一个常用的代码格式

```
#pragma mark - LifeCycle

#pragma mark - Delegate

#pragma mark - Public

#pragma mark - Private

#pragma mark - Getter

#pragma mark - Setter

``` 
可以非常清晰的找到代码的位置,进行新功能添加和修改


#### 措施4: 配置化设置

在考虑UI布局和功能的时候考虑进去配置化的操作,例如在书架用的是collectionView 可以配置的有格子的大小,行间距,组间距,图片的大小,有无阴影等.

在工程中多添加一个样式管理的类和一个默认的defaultConfiguration,专门管理样式,defaultConfigration可以是一个plist文件,也可以是一个包含json串的文件

这样等着修改样式的时候,就可以做到替换怎加一个customConfiguration,用于配置特异性的工程,类似网页替换css的代码文件

#### 措施5: git的规范使用和良好的版本控制

gitFlow工作流程

![](/Users/CharlyZhang/Documents/工作文档/snipImages/Snip20180111_1.png )

* Master:稳定版本的发布分支,可以说每一个master 就是一个版本
* Hotfix: 在稳定版本版本发布后的分支上的BUG修复分支
* Release: 在Develop分支开发完成后,合并到Master之前的临时分支,用于测试和编写文档等
* Develop: 新版本的开发分支(不稳定)
* Feature: 新功能的多人协作分支

项目分支的管理上,我们要基于每一个master分支,迁出一个个的交付项目分支(广西,内蒙古等),
在分支上只对两部分的修改和图片元素等的版本控制:

* 工程的配置文件: 主要控制如app的名称,图标,版本号等
* 项目中的配置文件: 替换customConfiguration,控制界面上,功能上的设置,例如替换css文件和设置一些功能的开关

> 不允许更改代码层面的代码











